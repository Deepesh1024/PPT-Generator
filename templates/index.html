<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Deepesh's AI PPT Generator</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
    <style>
        * {margin:0; padding:0; box-sizing:border-box;}
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #000;
            min-height: 100vh;
            padding: 20px;
            color: white;
        }
        .container {max-width:1200px; margin:0 auto;}
        .header {
            text-align:center;
            margin-bottom:40px;
            color:white;
        }
        .header h1 {
            font-size:3rem;
            margin-bottom:10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            letter-spacing:2px;
            color: white;
        }
        .header p {
            font-size:1.2rem;
            opacity:1;
            color: white;
        }
        .main-card {
            background:rgba(28, 28, 28, 0.75);
            border-radius:20px;
            padding:40px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.8);
            backdrop-filter: blur(12px);
            margin-bottom:30px;
            color: white;
        }
        .form-group {margin-bottom:30px;}
        .form-group label {
            display:block; font-weight:600;
            margin-bottom:10px; color:white; font-size:1.1rem;
        }
        .form-group input[type="text"] {
            width:100%; padding:15px 20px;
            border:2px solid #222; border-radius:10px;
            font-size:16px; background:#212121; color:white;
            transition:all 0.3s ease;
        }
        .form-group input[type="text"]:focus {
            outline:none; border-color:#20d67b;
            background:#191919; box-shadow:0 0 0 3px rgba(32, 214, 123, 0.15);
            color:white;
        }
        .form-group input[type="text"]::placeholder {
            color: #ccc;
        }
        .slider-container {display:flex; align-items:center; gap:20px;}
        .slider {
            flex:1; height:8px; border-radius:4px;
            background:#222; outline:none; appearance:none;
        }
        .slider::-webkit-slider-thumb {
            appearance:none; width:24px; height:24px; border-radius:50%;
            background:rgba(32, 214, 123, 0.7); cursor:pointer;
            box-shadow: 0 4px 8px rgba(32, 214, 123, 0.25);
            border:2px solid #17b56a;
        }
        .slider-value {
            background:rgba(32,214,123,0.7); color:white;
            padding:10px 20px; border-radius:25px;
            font-weight:600; min-width:100px; text-align:center;
        }
        .generate-btn {
            width:100%; padding:18px 30px;
            background: linear-gradient(135deg, rgba(32,214,123,0.9) 0%, rgba(26, 178, 94, 0.85) 100%);
            color: white; border:none; border-radius:15px;
            font-size:1.2rem; font-weight:600; cursor:pointer;
            transition: all 0.3s ease;
            box-shadow: 0 10px 20px rgba(32,214,123,0.35);
            backdrop-filter: blur(6px);
        }
        .generate-btn:hover:not(:disabled) {
            transform:translateY(-2px);
            box-shadow: 0 15px 30px rgba(32,214,123,0.5);
        }
        .generate-btn:disabled {
            opacity:0.6; cursor:not-allowed; transform:none;
        }
        .status-indicator {
            display:flex; align-items:center; justify-content:center;
            gap:10px; margin-bottom:20px; padding:10px 20px;
            background:rgba(0,0,0,0.25);
            border-radius:25px; color:white; font-weight:500;
        }
        .status-dot {
            width:10px; height:10px; border-radius:50%;
            background:#20d67b; animation:pulse 2s infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity:1; }
            50% { opacity:0.5; }
        }
        .progress-section { display:none; text-align:center; }
        .progress-bar {
            width:100%; height:12px; background:#222; border-radius:6px;
            margin:20px 0; overflow:hidden;
        }
        .progress-fill {
            height:100%; background:linear-gradient(90deg, #20d67b, #17b56a);
            width:0%; transition:width 0.5s ease;
        }
        .progress-steps {
            display:grid; grid-template-columns:repeat(4, 1fr);
            gap:15px; margin:30px 0;
        }
        .step {
            display:flex; flex-direction:column; align-items:center;
            gap:10px; padding:20px; border-radius:15px; background:#212121;
            color:white; transition:all 0.3s ease;
        }
        .step.active {
            background:rgba(32,214,123,0.9); color:white; transform:scale(1.05);
        }
        .step.completed {
            background:rgba(23,181,106,0.95); color:white;
        }
        .step i {font-size:2rem;}
        .results-section {display:none;}
        .results-header {
            display:flex; justify-content:space-between; align-items:center;
            margin-bottom:30px; flex-wrap:wrap; gap:15px;
        }
        .results-header h2 {
            color:white; font-size:2rem;
            text-shadow:0 2px 7px #0005;
        }
        .download-btn, .view-btn {
            padding:12px 25px;
            background: linear-gradient(120deg, rgba(45,255,162,0.7) 0%, rgba(32,214,123,0.7) 100%);
            color:white; border:none; border-radius:10px; font-weight:600; 
            cursor:pointer; transition:all 0.3s ease; text-decoration:none;
            display:inline-flex; align-items:center; gap:8px; margin-right:10px;
            box-shadow:0 4px 16px rgba(32,214,123,0.25);
            backdrop-filter:blur(2px);
        }
        .download-btn:hover, .view-btn:hover {
            background:linear-gradient(120deg, #20d67b 0%, #17b56a 100%);
            transform:translateY(-2px);
        }
        .slides-preview {
            display:grid; grid-template-columns:repeat(auto-fit, minmax(300px, 1fr)); gap:20px;
        }
        .slide-card {
            background:rgba(32,214,123,0.10); border-radius:15px; overflow:hidden;
            box-shadow:0 10px 25px rgba(0,0,0,0.35); transition:all 0.3s ease;
            position:relative;
        }
        .slide-card:hover {
            transform:translateY(-5px); box-shadow:0 20px 40px rgba(32,214,123,0.25);
        }
        .slide-number {
            position:absolute; top:15px; right:15px;
            background:rgba(32,214,123,0.7); color:white;
            padding:5px 12px; border-radius:15px; font-size:0.9rem; font-weight:600; z-index:1;
        }
        .slide-image {
            width:100%; height:200px; background:#181818;
            display:flex; align-items:center; justify-content:center; overflow:hidden;
        }
        .slide-image img {
            width:100%; height:100%; object-fit:cover;
        }
        .slide-image .placeholder {
            color:#17b56a; font-size:3rem;
        }
        .slide-content {
            padding:20px;
        }
        .slide-title {
            font-size:1.3rem; font-weight:600; margin-bottom:10px; color:white;
        }
        .slide-description {
            color:white; line-height:1.5;
        }
        .error-section {display:none; text-align:center;}
        .error-message {
            color:#ff6b6b; margin:20px 0; padding:20px;
            background:rgba(220,38,38,0.15); border-radius:10px; 
            border:1px solid rgba(220,38,38,0.25);
        }
        .retry-btn {
            padding:12px 25px;
            background:linear-gradient(135deg, rgba(32,214,123,0.7), rgba(23,181,106,0.7));
            color:white; border:none; border-radius:10px; font-weight:600;
            cursor:pointer; transition:all 0.3s ease;
        }
        .retry-btn:hover {
            background:linear-gradient(135deg,#20d67b,#17b56a);
            transform:translateY(-2px);
        }
        @keyframes spin {from{transform:rotate(0deg);} to{transform:rotate(360deg);}}
        .fa-spinner {animation: spin 1s linear infinite;}
        @media (max-width: 768px) {
            .header h1 { font-size:2rem; }
            .main-card { padding:20px; }
            .progress-steps { grid-template-columns:repeat(2, 1fr);}
            .results-header {flex-direction:column; text-align:center;}
        }
        /* Glassy effect for green buttons */
        .download-btn, .view-btn, .retry-btn{
            border: 2px solid rgba(32,214,123,0.35);
            box-shadow: 0 0 16px 4px rgba(32,214,123,0.13), 0 8px 32px 0 rgba(32,214,123,0.10);
            backdrop-filter: blur(2px);
        }
        
        /* PPT Viewer Modal Styles - FIXED SCROLLING */
        #pptViewerModal {
            display:none; 
            position:fixed; 
            z-index:2000; 
            top:0; 
            left:0; 
            width:100vw; 
            height:100vh; 
            background:rgba(0,0,0,0.95);
            overflow-y: auto; /* Enable vertical scrolling on modal background */
        }
        
        .modal-content-container {
            max-width:900px; 
            margin:40px auto; 
            background:rgba(32,214,123,0.13); 
            border-radius:30px; 
            padding:30px; 
            box-shadow:0 0 70px 5px #10b98199; 
            position:relative;
            min-height: calc(100vh - 80px); /* Ensure minimum height */
            max-height: none; /* Remove height constraints */
        }
        
        .modal-header {
            position: sticky;
            top: 0;
            background: rgba(32,214,123,0.13);
            z-index: 10;
            padding-bottom: 20px;
            margin-bottom: 20px;
            border-bottom: 2px solid rgba(32,214,123,0.3);
        }
        
        .close-viewer-btn {
            position:absolute; 
            top:15px; 
            right:20px; 
            background:rgba(32,214,123,0.35); 
            border:none; 
            color:#fff; 
            font-size:1.3rem; 
            border-radius:40px; 
            padding:7px 15px; 
            cursor:pointer;
            transition: all 0.3s ease;
        }
        
        .close-viewer-btn:hover {
            background:rgba(32,214,123,0.6);
            transform: scale(1.1);
        }
        
        .modal-title {
            color:white; 
            text-align:center; 
            margin-bottom:30px;
            font-size: 2rem;
            text-shadow: 0 2px 10px rgba(0,0,0,0.5);
        }
        
        .viewer-slides-content {
            display:flex; 
            flex-direction:column; 
            gap:30px;
            padding-bottom: 40px; /* Extra space at bottom */
        }
        
        .viewer-slide {
            background:rgba(40,40,40,0.8); 
            padding:25px; 
            border-radius:18px;
            box-shadow:0 8px 25px rgba(32,214,123,0.15); 
            margin-bottom:15px;
            border: 1px solid rgba(32,214,123,0.2);
        }
        
        .viewer-slide h3 {
            color:#20d67b; 
            margin-bottom:15px;
            font-size: 1.4rem;
            text-shadow: 0 2px 5px rgba(0,0,0,0.3);
        }
        
        .viewer-slide-image {
            margin-bottom:15px;
        }
        
        .viewer-slide-image img {
            max-width:100%; 
            height:auto; 
            max-height:300px;
            border-radius:8px; 
            object-fit:cover; 
            margin-bottom:10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }
        
        .viewer-slide-content {
            color:white; 
            font-size:1.1rem; 
            line-height: 1.6;
            word-break:break-word;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1><i class="fas fa-magic"></i> Deepesh's AI PPT Generator</h1>
            <p>Create professional presentations with advanced AI content & live preview</p>
        </div>
        <div class="status-indicator" id="statusIndicator">
            <div class="status-dot"></div>
            <span>Ready</span>
        </div>
        <div class="main-card">
            <form id="pptForm">
                <div class="form-group">
                    <label for="topic">
                        <i class="fas fa-lightbulb"></i> Presentation Topic
                    </label>
                    <input 
                        type="text" 
                        id="topic" 
                        name="topic" 
                        placeholder="Enter your presentation topic (e.g., Machine Learning, Climate Change, Marketing Strategy)"
                        required maxlength="200"
                    >
                </div>
                <div class="form-group">
                    <label for="slides_count">
                        <i class="fas fa-layer-group"></i> Number of Slides
                    </label>
                    <div class="slider-container">
                        <input 
                            type="range" 
                            id="slides_count" 
                            name="slides_count" 
                            min="3" 
                            max="20" 
                            value="5"
                            class="slider"
                        >
                        <div class="slider-value">
                            <span id="sliderValue">5</span> slides
                        </div>
                    </div>
                </div>
                <button type="submit" class="generate-btn" id="generateBtn">
                    <i class="fas fa-wand-magic-sparkles"></i>
                    Generate Presentation
                </button>
            </form>
        </div>
        <!-- Progress Section -->
        <div class="main-card progress-section" id="progressSection">
            <h2 style="color: white;">Generating Your Presentation</h2>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            <div class="progress-steps">
                <div class="step" id="step1">
                    <i class="fas fa-sitemap"></i>
                    <span>Creating Structure</span>
                </div>
                <div class="step" id="step2">
                    <i class="fas fa-pen-fancy"></i>
                    <span>Writing Content</span>
                </div>
                <div class="step" id="step3">
                    <i class="fas fa-image"></i>
                    <span>Generating Images</span>
                </div>
                <div class="step" id="step4">
                    <i class="fas fa-file-powerpoint"></i>
                    <span>Building PowerPoint</span>
                </div>
            </div>
            <div id="progressText" style="color: white;">Starting generation process...</div>
        </div>
        <!-- Results Section -->
        <div class="main-card results-section" id="resultsSection">
            <div class="results-header">
                <h2>Your Presentation is Ready!</h2>
                <div>
                    <a id="downloadBtn" class="download-btn" target="_blank">
                        <i class="fas fa-download"></i>
                        Download PowerPoint
                    </a>
                    <button id="viewBtn" class="view-btn">
                        <i class="fas fa-eye"></i>
                        Open in Viewer
                    </button>
                    <button id="newPresentationBtn" class="retry-btn" style="margin-left:10px;">
                        <i class="fas fa-plus"></i>
                        Create New
                    </button>
                </div>
            </div>
            <div class="slides-preview" id="slidesPreview"></div>
        </div>
        <!-- Error Section -->
        <div class="main-card error-section" id="errorSection">
            <h2 style="color: white;"><i class="fas fa-exclamation-triangle"></i> Generation Failed</h2>
            <div class="error-message" id="errorMessage">
                An error occurred while generating your presentation.
            </div>
            <button id="retryBtn" class="retry-btn">
                <i class="fas fa-redo"></i>
                Try Again
            </button>
        </div>
    </div>
    
    <!-- PPT Viewer Modal - FIXED SCROLLING -->
    <div id="pptViewerModal">
        <div class="modal-content-container">
            <div class="modal-header">
                <button id="closeViewerBtn" class="close-viewer-btn">&times;</button>
                <h2 class="modal-title">PPT Viewer</h2>
            </div>
            <div id="viewerSlidesContent" class="viewer-slides-content"></div>
        </div>
    </div>
    
    <script>
        class PPTGenerator {
            constructor() {
                this.initializeElements();
                this.bindEvents();
                this.checkStatus();
                this.slidesData = [];
            }
            initializeElements() {
                this.form = document.getElementById('pptForm');
                this.topicInput = document.getElementById('topic');
                this.slidesSlider = document.getElementById('slides_count');
                this.sliderValue = document.getElementById('sliderValue');
                this.generateBtn = document.getElementById('generateBtn');

                this.progressSection = document.getElementById('progressSection');
                this.resultsSection = document.getElementById('resultsSection');
                this.errorSection = document.getElementById('errorSection');

                this.progressFill = document.getElementById('progressFill');
                this.progressText = document.getElementById('progressText');
                this.slidesPreview = document.getElementById('slidesPreview');
                this.downloadBtn = document.getElementById('downloadBtn');
                this.viewBtn = document.getElementById('viewBtn');
                this.newPresentationBtn = document.getElementById('newPresentationBtn');
                this.errorMessage = document.getElementById('errorMessage');
                this.retryBtn = document.getElementById('retryBtn');
                this.statusIndicator = document.getElementById('statusIndicator');

                this.pptViewerModal = document.getElementById('pptViewerModal');
                this.closeViewerBtn = document.getElementById('closeViewerBtn');
                this.viewerSlidesContent = document.getElementById('viewerSlidesContent');
            }
            bindEvents() {
                this.form.addEventListener('submit', (e) => this.handleFormSubmit(e));
                this.slidesSlider.addEventListener('input', (e) => this.updateSliderValue(e));
                this.newPresentationBtn.addEventListener('click', () => this.resetForm());
                this.retryBtn.addEventListener('click', () => this.retryGeneration());
                this.viewBtn.addEventListener('click', () => this.openViewer());
                this.closeViewerBtn.addEventListener('click', () => this.closeViewer());
                
                // Close modal when clicking outside content
                this.pptViewerModal.addEventListener('click', (e) => {
                    if (e.target === this.pptViewerModal) {
                        this.closeViewer();
                    }
                });
            }
            updateSliderValue(e) {
                this.sliderValue.textContent = e.target.value;
            }
            async handleFormSubmit(e) {
                e.preventDefault();
                const topic = this.topicInput.value.trim();
                const slidesCount = parseInt(this.slidesSlider.value);
                if (!topic) { alert('Please enter a presentation topic'); return; }
                await this.generatePresentation(topic, slidesCount);
            }
            async generatePresentation(topic, slidesCount) {
                try {
                    this.showSection('progress');
                    this.startProgressAnimation();
                    this.setFormDisabled(true);
                    const response = await fetch('/api/generate-ppt', {
                        method: 'POST',
                        headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify({topic: topic, slides_count: slidesCount})
                    });
                    const result = await response.json();
                    if (result.success) {
                        this.displayResults(result);
                    } else {
                        this.displayError(result.error || 'Unknown error occurred');
                    }
                } catch (error) {
                    console.error('Generation error:', error);
                    this.displayError('Network error. Please check your connection.');
                } finally {
                    this.setFormDisabled(false);
                }
            }
            startProgressAnimation() {
                const steps = ['step1', 'step2', 'step3', 'step4'];
                const texts = [
                    'Analyzing topic and creating structure...',
                    'Generating engaging content...',
                    'Creating AI images...',
                    'Building PowerPoint...'
                ];
                let currentStep = 0;
                const interval = setInterval(() => {
                    if (currentStep < steps.length) {
                        if (currentStep > 0) {
                            document.getElementById(steps[currentStep - 1]).classList.remove('active');
                            document.getElementById(steps[currentStep - 1]).classList.add('completed');
                        }
                        document.getElementById(steps[currentStep]).classList.add('active');
                        const progress = ((currentStep + 1) / steps.length) * 100;
                        this.progressFill.style.width = `${progress}%`;
                        this.progressText.textContent = texts[currentStep];
                        currentStep++;
                    } else {
                        clearInterval(interval);
                        document.getElementById(steps[steps.length - 1]).classList.remove('active');
                        document.getElementById(steps[steps.length - 1]).classList.add('completed');
                    }
                }, 2000);
            }
            displayResults(result) {
                this.showSection('results');
                if (result.ppt_url) {
                    this.downloadBtn.href = result.ppt_url;
                    this.downloadBtn.download = '';
                }
                this.slidesData = (result.slides_data && Array.isArray(result.slides_data)) ? result.slides_data : [];
                this.displaySlidesPreview(this.slidesData);
            }
            displaySlidesPreview(slidesData) {
                if (!slidesData || !Array.isArray(slidesData)) {
                    this.slidesPreview.innerHTML = '<p style="color: white;">No slides data available</p>';
                    return;
                }
                this.slidesPreview.innerHTML = '';
                slidesData.forEach(slide => {
                    const slideCard = document.createElement('div');
                    slideCard.className = 'slide-card';
                    const imageSection = slide.image_url
                        ? `<img src="${slide.image_url}" alt="Slide ${slide.slide_number}" loading="lazy">`
                        : `<div class="placeholder"><i class="fas fa-image"></i></div>`;
                    slideCard.innerHTML = `
                        <div class="slide-number">${slide.slide_number}</div>
                        <div class="slide-image">${imageSection}</div>
                        <div class="slide-content">
                            <div class="slide-title">${this.escapeHtml(slide.title)}</div>
                            <div class="slide-description">${this.escapeHtml((slide.content || '').substring(0, 150) + '...' || 'Content generated')}</div>
                        </div>
                    `;
                    this.slidesPreview.appendChild(slideCard);
                });
            }
            displayError(errorMessage) {
                this.showSection('error');
                this.errorMessage.textContent = errorMessage;
            }
            showSection(sectionName) {
                [this.progressSection, this.resultsSection, this.errorSection].forEach(
                    section => { section.style.display='none'; });
                const sections = {
                    'progress': this.progressSection,
                    'results': this.resultsSection,
                    'error': this.errorSection
                };
                if (sections[sectionName]) {
                    sections[sectionName].style.display = 'block';
                    sections[sectionName].scrollIntoView({behavior: 'smooth'});
                }
            }
            setFormDisabled(disabled) {
                this.generateBtn.disabled = disabled;
                this.topicInput.disabled = disabled;
                this.slidesSlider.disabled = disabled;
                this.generateBtn.innerHTML = disabled
                    ? '<i class="fas fa-spinner fa-spin"></i> Generating...'
                    : '<i class="fas fa-wand-magic-sparkles"></i> Generate Presentation';
            }
            resetForm() {
                this.topicInput.value='';
                this.slidesSlider.value='5';
                this.updateSliderValue({target: this.slidesSlider});
                [this.progressSection, this.resultsSection, this.errorSection].forEach(
                    section => {section.style.display='none';});
                this.progressFill.style.width='0%';
                document.querySelectorAll('.step').forEach(
                    step => {step.classList.remove('active','completed');});
                this.setFormDisabled(false);
                this.topicInput.focus();
                this.closeViewer();
            }
            retryGeneration() {
                if (this.topicInput.value.trim()) {
                    this.handleFormSubmit(new Event('submit'));
                } else {
                    this.resetForm();
                }
            }
            async checkStatus() {
                try {
                    const response = await fetch('/api/status');
                    const status = await response.json();
                    this.updateStatusIndicator(status);
                } catch (error) {
                    console.error('Status check failed:', error);
                }
            }
            updateStatusIndicator(status) {
                const statusText = this.statusIndicator.querySelector('span');
                const statusDot = this.statusIndicator.querySelector('.status-dot');
                if (status.status === 'running' && status.model_loaded) {
                    statusText.textContent = 'Ready';
                    statusDot.style.background = '#20d67b';
                } else if (status.status === 'running') {
                    statusText.textContent = 'Loading...';
                    statusDot.style.background = '#f59e0b';
                } else {
                    statusText.textContent = 'Offline';
                    statusDot.style.background = '#dc2626';
                }
            }
            escapeHtml(unsafe) {
                if (!unsafe) return '';
                return unsafe
                    .replace(/&/g, "&amp;")
                    .replace(/</g, "&lt;")
                    .replace(/>/g, "&gt;")
                    .replace(/"/g, "&quot;")
                    .replace(/'/g, "'");
            }
            openViewer() {
                if (!Array.isArray(this.slidesData) || this.slidesData.length === 0) return;
                
                // Prevent body scrolling when modal is open
                document.body.style.overflow = 'hidden';
                
                this.pptViewerModal.style.display='block';
                this.viewerSlidesContent.innerHTML='';
                
                this.slidesData.forEach(slide=>{
                    const div=document.createElement('div');
                    div.className = 'viewer-slide';
                    div.innerHTML=`
                        <h3>Slide ${slide.slide_number}: ${this.escapeHtml(slide.title)}</h3>
                        <div class="viewer-slide-image">
                            ${slide.image_url? `<img src="${slide.image_url}" alt="Slide ${slide.slide_number}">`:''}
                        </div>
                        <div class="viewer-slide-content">${this.escapeHtml(slide.content||'')}</div>
                    `;
                    this.viewerSlidesContent.appendChild(div);
                });
                
                // Scroll to top of modal
                this.pptViewerModal.scrollTop = 0;
            }
            closeViewer() {
                this.pptViewerModal.style.display='none';
                // Restore body scrolling
                document.body.style.overflow = '';
            }
        }
        document.addEventListener('DOMContentLoaded', function(){
            window.pptGenerator = new PPTGenerator();
        });
    </script>
</body>
</html>
